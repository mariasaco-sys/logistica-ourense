import streamlit as st
import pandas as pd
import folium
from folium.features import DivIcon
from streamlit_folium import st_folium
from geopy.distance import geodesic
from geopy.geocoders import Nominatim
import requests
import time
import io
import random

# --- CONFIGURACI√ìN DE LA P√ÅGINA ---
st.set_page_config(page_title="Log√≠stica Ourense Pro", layout="wide")

st.title("üöõ Calculadora Log√≠stica (Alerta Pyxis)")
st.markdown("Calcula rutas y gestiona alertas de veh√≠culos especiales.")

# --- 0. DATOS HIST√ìRICOS ---
CSV_DATA = """Ruta_Asignada,C√≥digo postal env√≠o,Ciudad_Clean,Num_Pedidos_Historico,Dia_Asignado
EJE ESTE (N-120),27400,MONFORTE DE LEMOS,29,Jueves
EJE ESTE (N-120),27500,CHANTADA,15,Jueves
EJE ESTE (N-120),32720,ESGOS,10,Jueves
EJE ESTE (N-120),32700,MACEDA,9,Jueves
EJE ESTE (N-120),27513,CHANTADA,7,Jueves
EJE ESTE (N-120),32706,MACEDA,6,Jueves
EJE ESTE (N-120),32760,CASTRO CALDELAS,5,Jueves
EJE ESTE (N-120),27400,MONFORTE,4,Jueves
EJE ESTE (N-120),32780,PUEBLA DE TRIVES,4,Jueves
EJE ESTE (N-120),27514,CHANTADA,3,Jueves
EJE ESTE (N-120),27320,"QUIROGA , MONFORTE",2,Jueves
EJE ESTE (N-120),27400,MONFORTE DE LEMOS CASCO URBANO,2,Jueves
EJE ESTE (N-120),27500,CHANTADA LUGO,2,Jueves
EJE ESTE (N-120),27517,CHANTADA,2,Jueves
EJE ESTE (N-120),27590,MONFORTE DE LEMOS,2,Jueves
EJE ESTE (N-120),32315,O BARCO DE VALDEORRAS,2,Jueves
EJE ESTE (N-120),32350,A RUA,2,Jueves
EJE ESTE (N-120),32766,CASTRO CALDELAS,2,Jueves
EJE ESTE (N-120),32769,CASTRO CALDELAS,2,Jueves
EJE ESTE (N-120),27400,MONFORTE DE LEMOS (GULLADE ),1,Jueves
EJE ESTE (N-120),27410,MONFORTE DE LEMOS,1,Jueves
EJE ESTE (N-120),27417,MONFORTE DE LEMOS,1,Jueves
EJE ESTE (N-120),27420,MONFORTE DE LEMOS,1,Jueves
EJE ESTE (N-120),27420,PI√ëEIRA SAN MARTI√ëO MONFORTE,1,Jueves
EJE ESTE (N-120),27512,LAXE XOANIN - CHANTADA,1,Jueves
EJE ESTE (N-120),27513,REQUEIXO CHANTADA,1,Jueves
EJE ESTE (N-120),27519,CHANTADA,1,Jueves
EJE ESTE (N-120),27595,CHANTADA,1,Jueves
EJE ESTE (N-120),32002,CHANTADA,1,Jueves
EJE ESTE (N-120),32300,"BARCO, O",1,Jueves
EJE ESTE (N-120),32300,O BARCO,1,Jueves
EJE ESTE (N-120),32300,O BARCO DE VALDEORRAS,1,Jueves
EJE ESTE (N-120),32350,A RUA DE VALDEORRAS,1,Jueves
EJE ESTE (N-120),32357,ROBLIDO A RUA,1,Jueves
EJE ESTE (N-120),32700,CASTRO CALDELAS,1,Jueves
EJE ESTE (N-120),32700,ORENSE MACEDA,1,Jueves
EJE ESTE (N-120),32708,MACEDA,1,Jueves
EJE ESTE (N-120),32720,GOMARIZ ESGOS,1,Jueves
EJE ESTE (N-120),32740,MACEDA,1,Jueves
EJE ESTE (N-120),32794,CASTRO CALDELAS,1,Jueves
EJE NORTE (AG-53/A-52),32500,O CARBALLI√ëO,36,Martes
EJE NORTE (AG-53/A-52),32400,RIBADAVIA,15,Martes
EJE NORTE (AG-53/A-52),32520,AVION,10,Martes
EJE NORTE (AG-53/A-52),36500,LALIN,10,Martes
EJE NORTE (AG-53/A-52),32500,"CARBALLI√ëO, O",7,Martes
EJE NORTE (AG-53/A-52),32130,SAN CRISTOVO DE CEA,6,Martes
EJE NORTE (AG-53/A-52),32420,LEIRO,6,Martes
EJE NORTE (AG-53/A-52),32426,LEIRO,3,Martes
EJE NORTE (AG-53/A-52),32570,MASIDE,3,Martes
EJE NORTE (AG-53/A-52),32418,RIBADAVIA,2,Martes
EJE NORTE (AG-53/A-52),32419,"VIEITE, LEIRO",2,Martes
EJE NORTE (AG-53/A-52),32420,LEBOSENDE- LEIRO,2,Martes
